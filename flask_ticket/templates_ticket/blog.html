{% extends "layout_ticket.html" %}

{% block BODY %}
<div class="card text-center border-success">
    <div class="card-header">
        <h4>{{pref_name}}</h4>
    </div>
    <div class="card-body">
        <div id="map" style="height: 65vh;"></div>
    </div>
</div>

<div id="image-overlay">
    <div class="card text-center border-success" style="width: 80%;">
        <span id="close-btn">&times;</span>
        <div class="card-header">
            <h4 id="overlay-title"></h4>
        </div>
        <div class="card-body">
            <img id="overlay-image" src="" style="max-width: 80%; max-height: 80%;">
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    var centerCoordinates = {{centerCoordinates|tojson}};
    var map = L.map('map').setView(centerCoordinates[0].coords, 9);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    var markers = {{markers|tojson}};
    markers.forEach(function (marker) {
        var markerObj = L.marker(marker.coords).addTo(map);
        markerObj.on('click', function () {
            showOverlayImage(marker.title, marker.photo);
        });
    });

    // 画像オーバーレイを表示する関数
    function showOverlayImage(title, photo) {
        var overlay = document.getElementById('image-overlay');
        overlay.style.display = 'flex';

        var overlayTitle = document.getElementById('overlay-title');
        overlayTitle.textContent = title;

        var overlayImage = document.getElementById('overlay-image');
        overlayImage.src = photo;
    }

    // オーバーレイを閉じる関数
    document.getElementById('close-btn').onclick = function () {
        document.getElementById('image-overlay').style.display = 'none';
    }
</script>

<style>
    #image-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    #close-btn {
        position: absolute;
        top: 0px;
        right: 10px;
        font-size: 50px;
        color: white;
        cursor: pointer;
    }
</style>

{% endblock %}